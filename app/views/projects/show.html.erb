<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-md-8 project-list" style="background-color: white;">
      <!-- Displaying the image -->
      <!--  cl_image_tag @article.photo.key, height: 300, width: 400, crop: :fill -->


      <h1><%= @project.name %></h1>
      <div class="card-description">
        <img src="<%= cl_image_path @project.photo.key, crop: :fill %>" />
        <div class="card-description-infos">
          <h3>Description</h3>
          <p><%= @project.description %></p>
        </div>
      </div>
      <br>
      <br>
      <div class="card-attributes d-flex justify-content-between">
        <div class="container">
          <h3>Project lead</h3>
          <div class="d-flex align-items-top">
            <img src="https://kitt.lewagon.com/placeholder/users/random" class="avatar-large">
            <p id ="project-lead-name"><%= @project.owner[:first_name] + " " + @project.owner[:last_name] %></p>
          </div>
        </div>
        <div class="container">
          <h3>Funding goal</h3>
          <p><%= @project.total_funding.to_s.gsub(/(?<=\d)(?=(?:\d{3})+\z)/, '.') %> €</p>
        </div>
        <div class="container">
          <h3>Impact area</h3>
          <p><%= @project.category %></p>
        </div>
      </div>
      <br>
      <br>
      <!-- show investment form when investor -->
      <div>
        <!-- checks if user is investor and gives him the option to insert offer -->
        <% if current_user.role == 'investor' %>
          <div class="container card-offer d-flex justify-content-between align-items-center">
            <div id="my-offer"><h3>My offer:</h3></div>
            <div id="form-div">
              <p>I want to invest:</p>
              <%= simple_form_for [ @project, @funding ], html: { class: 'form-inline' } do |f| %>
                <%= f.input :funding_amount, placeholder: '1.000 €                                  ', label: false %>
                <%= f.submit 'Submit offer', class: 'btn btn-primary' %>
              <%end %>
            </div>
          </div>
        <% end %>
      </div>


      <div class="container">
        <!-- checks if user is owner and only shows funding offers to them not to investors -->
        <% if current_user.role == 'owner' %>
          <div>
            <h3>Offers:</h3>
            <% @fundings.each do |funding| %>
              <div class="funding">
                <%= image_tag("#{rand(1..22).to_s}.jpg", :class => "avatar-large") %>
                <div class="funding-content">
                  <p><strong>Investor:</strong> <%= funding.investor.first_name %> <%= funding.investor.last_name %></p>
                  <p><strong>Offered funding:</strong> <%= funding.funding_amount.to_s.gsub(/(?<=\d)(?=(?:\d{3})+\z)/, ' ') %> €</p>
                </div>
                <div class="funding-actions">
                  <% if funding.accepted? %>
                    <i class="fas fa-check-square fa-2x"></i>
                  <% else %>
                    Accept offer: <%= link_to accept_project_path(@project, funding: funding), method: :post do %>
                      <i class="far fa-square fa-2x"></i>
                    <% end %>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>



      <div class="icons-show mt-md-5">
        <% if current_user.role == 'owner' %>
          <span>
            <%= link_to edit_project_path(@project) do %>
              <i class="far fa-edit fa-2x"></i>
              <% end %>
          </span>
          <span>
            <%= link_to project_path(@project),
              method: :delete,
              data: { confirm: "Are you sure?" } do %>
                <i class="far fa-trash-alt fa-2x"></i>
              <% end %>
          </span>
        <% end %>
      </div>
    </div>
  </div>
</div>
